# ==ICMP协议==

1.理解ICMP协议

2.理解ICMP重定向

3.会使用wireshark分析ICMP重定向流量

实验

## 一、ICMP基本概念

### 1.ICMP协议

- Internet控制报文协议，用于在IP主机，路由器之间传递消息，控制消息指网络不通，主机是否可达，路由是否可用等等
- ICMP是属于网络层协议，封装在传输层与网络层之间

### 2.ICMP报文格式

<img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20230810122845960.png" alt="image-20230810122845960" style="zoom:200%;" />



| 类型（type） | 类型（type） | 报文结果                       |
| ------------ | ------------ | ------------------------------ |
| 8            | 0            | 请求                           |
| 0            | 0            | 回显应答（表示比较正常的应答） |
| 3            | 1            | 目标不可达（主机不可达）       |
| 11           | 0            | 超时（传输期间生存时间为0）    |
| 3            | 3            | 目标不可达（端口不可达）       |
| 3            | 2            | 协议不可达                     |
| 13/14        |              | 时间戳请求和应答               |
| 5            | 0            | 重定向（网络重定向）           |
| 5            | 1            | 重定向（主机重定向）           |

### 二、ICMP重定向

1.原理实验：

<img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20230810144943114.png" alt="image-20230810144943114" style="zoom:200%;" />

主机要访问192.168.30.1，会先将自己的数据发给自己的网关，然后网关发现自己有192.168.30.1的路由（需要自己配置）然后网关会给192.168.30.1发送一个ARP请求，然后给主机发送一个ICMP重定向，使得网关的MAC地址变为192.168.30.1的MAC地址，之后主机想192.168.30.1所发送的数据都会直接通过右侧链路发送出去，就不再经过自己的网关了

2.攻击实验：

在kali上使用工具实施ICMP重定向网关

工具：

- 命令工具netwox `netwox 86 -g 重定向的网关` ，这个会对网络中扫描到的所有主机发送ICMP重定向
- 图形化工具：ettercap

​    